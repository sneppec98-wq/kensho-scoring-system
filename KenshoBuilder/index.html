<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kensho Builder Pro - Master Template</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>

    <link rel="stylesheet" href="css/builder.css">

    <style>
        .badge-version {
            display: inline-block;
            padding: 1px 5px;
            background: rgba(148, 163, 184, 0.1);
            color: #64748b;
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 4px;
            font-size: 0.45rem;
            font-weight: 900;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }
    </style>
</head>

<body>
    <!-- STUDIO LAUNCHER (MODULE SELECTOR) -->
    <div id="studio-launcher">
        <div class="launcher-card">
            <h2 class="launcher-title">SELECT STUDIO MODULE</h2>
            <div class="module-options">
                <button class="module-btn" onclick="selectModule('bracket')">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                    </svg>
                    BRACKET BUILDER (KUMITE/KATA)
                </button>
                <button class="module-btn opacity-20 cursor-not-allowed">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                    </svg>
                    OFFICIAL LIST BUILDER (COMING SOON)
                </button>
            </div>
        </div>
    </div>

    <!-- UNIFIED STUDIO COCKPIT HEADER -->
    <header class="studio-header">
        <!-- TOP ROW: GLOBAL TOOLS -->
        <div class="header-top-row">
            <div class="flex items-center gap-3">
                <div class="bg-slate-900/5 p-1 rounded-lg border border-slate-200">
                    <img src="../kensho-logo.png" alt="Logo" class="w-6 h-6 object-contain">
                </div>
                <span class="text-slate-900 font-black text-xs tracking-widest">KENSHO PRO STUDIO</span>
                <div class="badge-version ml-2">v2.1</div>
            </div>

            <div class="ml-auto flex items-center gap-3">
                <button onclick="saveProgress()" id="saveProgressBtn"
                    class="bg-emerald-500 hover:bg-emerald-600 text-white text-[9px] font-black py-2 px-5 rounded-full flex items-center gap-2 transition-all opacity-50 cursor-not-allowed"
                    disabled>
                    SAVE PROGRESS
                </button>
                <button onclick="exportAsImage()"
                    class="bg-blue-600 hover:bg-blue-700 text-white text-[9px] font-black py-2 px-5 rounded-full shadow-lg shadow-blue-500/10 transition-all">
                    EKSPOR PNG
                </button>
            </div>
        </div>

        <!-- Bottom Row Removed -->
    </header>

    <!-- MAIN INTERFACE: DOCKED COCKPIT -->
    <div class="studio-main-wrapper">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <a href="../dashboard.html" class="side-icon-btn" title="Back to Dashboard">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
            </a>

            <!-- Flyout Add Removed (SVG Focus) -->

            <div class="side-icon-btn" onclick="toggleFlyout('flyout-storage', this)" title="Cloud Storage">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                </svg>
            </div>

            <!-- Magic Auto-Pair Removed -->

            <!-- Standard Print Removed -->

            <div class="side-icon-btn" onclick="document.getElementById('svgTemplateInput').click()"
                title="üé® Load SVG Template (Sportdata Look)" style="background: #0f172a; border: 1px solid #38bdf8;">
                <svg class="w-5 h-5 text-[#38bdf8]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <input type="file" id="svgTemplateInput" accept=".svg" style="display: none;"
                    onchange="handleSVGUpload(event)">
            </div>

            <!-- Premium PDF and Gong Removed as per image request -->
            <div class="side-icon-btn" onclick="exportToPDF()" title="üñ®Ô∏è SVG PRINT F4 (Precision)"
                style="background: #0f172a; border: 1px solid #10b981;">
                <svg class="w-5 h-5 text-[#10b981]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                </svg>
            </div>

            <!-- Download Tagged SVG -->
            <div class="side-icon-btn" onclick="downloadSVG()" title="üì• Download Tagged SVG Template"
                style="background: #0f172a; border: 1px solid #c084fc;">
                <svg class="w-5 h-5 text-[#c084fc]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
            </div>

            <div class="w-full h-px bg-slate-200 my-2"></div>

            <div class="side-icon-btn" onclick="undo()" title="Undo">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
                </svg>
            </div>

        </div>

        <!-- CANVAS AREA -->
        <div id="canvas-container">
            <!-- DRAWING AREA -->
            <div id="canvas" class="canvas-grid">
                <div id="template-svg-layer"></div>
                <svg id="line-canvas"></svg>
            </div>
        </div>

        <!-- PROPERTY INSPECTOR (DOCKED RIGHT) -->
        <div id="propertySidebar" class="property-sidebar">
            <div class="flex items-center justify-between mb-6 pb-4 border-b border-slate-200">
                <h3 class="font-black text-[10px] tracking-[0.2em] text-slate-800 uppercase">PROPERTIES</h3>
            </div>
            <div id="propContent">
                <div class="flex flex-col items-center justify-center h-full opacity-30 py-20 text-center">
                    <svg class="w-12 h-12 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                            d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122" />
                    </svg>
                    <p class="text-[10px] font-bold uppercase tracking-widest leading-relaxed">Pilih elemen
                        untuk<br>mengatur detil</p>
                </div>
            </div>
        </div>
    </div> <!-- END studio-main-wrapper -->

    <!-- FLYOUTS -->
    <!-- Flyout Add Removed -->

    <div id="flyout-storage" class="flyout-panel w-[300px]">
        <h4 class="text-[10px] font-black tracking-widest text-slate-400 mb-4 uppercase">CLOUD STORAGE</h4>
        <div class="flex flex-col gap-3">
            <input type="text" id="templateSearch" onkeyup="filterTemplates(this.value)" placeholder="Cari template..."
                class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-xs">
            <div id="templateList" class="max-h-[300px] overflow-y-auto flex flex-col gap-1 pr-1">
                <div class="text-[10px] text-slate-400 text-center py-8">Memuat data dari cloud...</div>
            </div>
            <button onclick="saveTemplate()"
                class="w-full bg-emerald-500 text-white py-3 rounded-xl text-[10px] font-black tracking-widest hover:bg-emerald-600 transition-all mt-2">
                SIMPAN SEBAGAI BARU
            </button>
        </div>
    </div>

    <!-- PRINT SETTINGS MODAL -->
    <div id="printModal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.7); z-index: 9999; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 16px; padding: 32px; max-width: 500px; width: 90%;">
            <h2 class="text-xl font-black mb-4">‚öôÔ∏è Pengaturan Cetak PDF</h2>
            <p class="text-sm text-slate-600 mb-6">Pilih ukuran cetak agar braket muat dalam kertas F4. Semakin kecil
                scale, semakin kecil font.</p>

            <div class="space-y-3 mb-6">
                <label
                    class="flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-slate-50 transition-all"
                    onclick="selectPrintScale(1.0, this)">
                    <input type="radio" name="printScale" value="1.0" class="w-5 h-5">
                    <div class="flex-1">
                        <div class="font-bold text-sm">100% - Original Size</div>
                        <div class="text-xs text-slate-500">Font tetap besar (~20px), tapi mungkin overflow ke halaman
                            2-3</div>
                    </div>
                </label>

                <label
                    class="flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-slate-50 transition-all"
                    onclick="selectPrintScale(0.75, this)">
                    <input type="radio" name="printScale" value="0.75" class="w-5 h-5">
                    <div class="flex-1">
                        <div class="font-bold text-sm">75% - Balanced</div>
                        <div class="text-xs text-slate-500">Font cukup besar (~15px), kemungkinan muat 1-2 halaman</div>
                    </div>
                </label>

                <label
                    class="flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-slate-50 transition-all"
                    onclick="selectPrintScale(0.6, this)">
                    <input type="radio" name="printScale" value="0.6" class="w-5 h-5">
                    <div class="flex-1">
                        <div class="font-bold text-sm">60% - Comfortable</div>
                        <div class="text-xs text-slate-500">Font readable (~12px), untuk braket sedang</div>
                    </div>
                </label>

                <label class="flex items-center gap-3 p-3 border-2 border-blue-500 bg-blue-50 rounded-lg cursor-pointer"
                    onclick="selectPrintScale(0.5, this)">
                    <input type="radio" name="printScale" value="0.5" class="w-5 h-5" checked>
                    <div class="flex-1">
                        <div class="font-bold text-sm text-blue-700">50% - Fit to Page (Recommended) ‚≠ê</div>
                        <div class="text-xs text-blue-600">Font ~10px, dijamin muat 1 halaman F4 untuk braket 16</div>
                    </div>
                </label>

                <label
                    class="flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-slate-50 transition-all"
                    onclick="selectPrintScale(0.45, this)">
                    <input type="radio" name="printScale" value="0.45" class="w-5 h-5">
                    <div class="flex-1">
                        <div class="font-bold text-sm">45% - Compact</div>
                        <div class="text-xs text-slate-500">Font kecil (~9px), untuk braket sangat besar</div>
                    </div>
                </label>

                <label
                    class="flex items-center gap-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-slate-50 transition-all"
                    onclick="selectPrintScale(0.4, this)">
                    <input type="radio" name="printScale" value="0.4" class="w-5 h-5">
                    <div class="flex-1">
                        <div class="font-bold text-sm">40% - Ultra Compact</div>
                        <div class="text-xs text-slate-500">Font sangat kecil (~8px), untuk braket maksimal</div>
                    </div>
                </label>
            </div>

            <div class="flex gap-3">
                <button onclick="closePrintModal()"
                    class="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-800 font-bold py-3 px-6 rounded-lg transition-all">
                    BATAL
                </button>
                <button onclick="confirmPrint()"
                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all">
                    üñ®Ô∏è CETAK SEKARANG
                </button>
            </div>
        </div>
    </div>

    <script src="js/builder.js"></script>
    <script type="module" src="../js/security-guard.js"></script>
</body>

</html>