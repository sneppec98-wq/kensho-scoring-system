<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Tersedia | Kensho Tech</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: rgba(15, 23, 42, 0.95);
            color: #f8fafc;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        .update-card {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
            height: 100%;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }

        .btn-download {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
            transition: all 0.3s;
        }

        .btn-download:hover:not(:disabled) {
            filter: brightness(1.1);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5);
        }

        .version-badge {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            background: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 0.75rem;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .changelog-box {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 1rem;
            padding: 1rem;
            text-align: left;
            font-size: 0.75rem;
            line-height: 1.6;
            flex: 1;
            overflow-y: auto;
            margin: 1.5rem 0;
            color: rgba(248, 250, 252, 0.8);
        }

        .progress-container {
            height: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
            display: none;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Customize Scrollbar */
        .changelog-box::-webkit-scrollbar {
            width: 4px;
        }

        .changelog-box::-webkit-scrollbar-track {
            background: transparent;
        }

        .changelog-box::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <div class="update-card">
        <div class="flex items-center justify-between mb-2">
            <div class="text-left">
                <h2 class="text-xl font-black text-white">Update Tersedia</h2>
                <p class="text-slate-400 text-[10px] uppercase font-bold tracking-widest mt-0.5" id="statusText">Versi
                    baru siap diunduh</p>
            </div>
            <div class="version-badge" id="newVersionText">v?.?.?</div>
        </div>

        <div class="changelog-box" id="changelog">
            <p class="opacity-50 italic">Memuat rincian pembaruan...</p>
        </div>

        <div id="progressArea" class="hidden">
            <div class="flex justify-between items-center mb-1">
                <span class="text-[10px] font-bold text-slate-500 uppercase">Mengunduh...</span>
                <span class="text-[10px] font-black text-blue-400" id="progressPercent">0%</span>
            </div>
            <div class="progress-container" style="display: block;">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>

        <div class="mt-auto pt-4 border-t border-white/5 space-y-3">
            <button id="mainBtn" onclick="handleAction()"
                class="btn-download w-full py-3.5 rounded-xl font-bold text-white text-xs uppercase tracking-widest flex items-center justify-center gap-2">
                Download & Install
            </button>
            <button id="laterBtn" onclick="window.close()"
                class="w-full py-2 text-[10px] font-bold text-slate-500 uppercase tracking-widest hover:text-slate-300 transition-colors">
                Nanti Saja
            </button>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        let version = urlParams.get('version');
        let currentStep = 'available'; // available, downloading, downloaded

        // Initial UI Setup
        if (version) document.getElementById('newVersionText').innerText = 'v' + version;

        // Listen for data if it was passed via IPC (detailed info)
        if (window.electronAPI && window.electronAPI.onUpdateAvailable) {
            window.electronAPI.onUpdateAvailable((info) => {
                const changelogEl = document.getElementById('changelog');
                if (info.releaseNotes) {
                    // Release notes could be HTML or string
                    changelogEl.innerHTML = info.releaseNotes;
                    document.getElementById('newVersionText').innerText = 'v' + info.version;
                    version = info.version;
                }
            });
        }

        // Listen for Progress
        if (window.electronAPI && window.electronAPI.onUpdateProgress) {
            window.electronAPI.onUpdateProgress((percent) => {
                const rounded = Math.round(percent);
                document.getElementById('progressBar').style.width = rounded + '%';
                document.getElementById('progressPercent').innerText = rounded + '%';
            });
        }

        // Listen for Completed Download
        if (window.electronAPI && window.electronAPI.onUpdateDownloaded) {
            window.electronAPI.onUpdateDownloaded(() => {
                currentStep = 'downloaded';
                updateUI();
            });
        }

        function updateUI() {
            const btn = document.getElementById('mainBtn');
            const statusText = document.getElementById('statusText');
            const progressArea = document.getElementById('progressArea');
            const laterBtn = document.getElementById('laterBtn');

            if (currentStep === 'downloading') {
                btn.disabled = true;
                btn.innerText = 'PROSES DOWNLOAD...';
                btn.classList.add('opacity-50');
                statusText.innerText = 'Sistem sedang mengunduh pembaruan';
                progressArea.classList.remove('hidden');
                laterBtn.classList.add('hidden');
            } else if (currentStep === 'downloaded') {
                btn.disabled = false;
                btn.innerText = 'INSTALL & RESTART';
                btn.classList.remove('opacity-50', 'btn-download');
                btn.classList.add('bg-green-600', 'shadow-[0_10px_30px_rgba(22,163,74,0.3)]');
                statusText.innerText = 'Download selesai! Siap untuk update';
                progressArea.classList.add('hidden');
                laterBtn.classList.add('hidden');
            }
        }

        function handleAction() {
            if (currentStep === 'available') {
                if (window.electronAPI && window.electronAPI.startDownload) {
                    window.electronAPI.startDownload();
                    currentStep = 'downloading';
                    updateUI();
                }
            } else if (currentStep === 'downloaded') {
                if (window.electronAPI && window.electronAPI.restartApp) {
                    window.electronAPI.restartApp();
                }
            }
        }
    </script>
</body>

</html>